{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Theogeek - {{ action }} Post{% endblock %}

<body>
{% block page_content %}


    <!-- Modal Trigger with link in dropdown -->
    {% for version in history %}
    <!-- Model from dropdown -->
    <div id="myModal{{ version.id }}" class="modal fade" role="dialog">
        <div class="modal-dialog">
        <!-- Modal content from dropdown-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{ version.title }}</h4>
              </div>
              <div class="modal-body">
                <p></p>{{ version.body }}</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
          </div>
        </div>
      </div>
    {% endfor %}





<div class="page-header">
    <h1>{{ action }} Post</h1>
</div>
<div>   
    <input type="hidden" name="post_id" value="{{ form.id.data }}">
    <form method="POST" class="form" role="form">
        {{ form.csrf_token }}
        <div class="btn-group"><a class="btn btn-default" href=# id=quick-submit>Quick Save</a></div>
        <div class="btn-group">
            <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">History
            <span class="caret"></span></button>
            <ul class="dropdown-menu pre-scrollable">
              <!-- Modal Trigger with link in dropdown -->
              {% for version in history %}
              <li><a data-toggle="modal" href="#myModal{{ version.id }}">
                  {{ moment(version.timestamp).format('YYYY/MM/DD, h:mm a') }}
              </a></li>
              {% endfor %}
            </ul>
          </div>
        <span class="btn-group"  style="float: right">
          <input type="submit" class="btn btn-default" onclick="" name="submit" value="Save Draft">
          <input type="submit" class="btn btn-default" onclidk="" name="submit" value="Publish & Close">
          <input type="submit" class="btn btn-default" onclidk="" name="submit" value="Close">
        </span>
        <br><br>
        <div><b>What am I called?</b><span name="post_status" style="float: right"><b>Status: {{ form.status.data }}</b></span></div>
        <input type="text" class="form-control" name="title" value="{{ form.title.data }}"><br>
        <b>Tell me a story</b>
        <textarea class="form-control" id="markdown" name="body" value={{ form.body }}
        <p><a class="btn btn-default" href=# id=quick-submit>Quick Save</a>
        <span class="btn-group"  style="float: right">
            <input type="submit" class="btn btn-default" onclick="" name="submit" value="Save Draft">
            <input type="submit" class="btn btn-default" onclidk="" name="submit" value="Publish & Close">
            <input type="submit" class="btn btn-default" onclidk="" name="submit" value="Close">
        </span><span id=result></span>
        <!-- <span class="container"> -->
          
        <!-- </span> -->
    </form> 
        
</div>
<br>
{% endblock %}
</body>

{% block scripts %}
{{ super() }}
<script type='text/javascript'>
      var simplemde = new SimpleMDE({
                                     forceSync: true,
                                     tabSize: 4,
                                     autosave: True,
                                     element: document.getElementById('markdown'),
                                     toolbar: ["bold", "italic", "strikethrough", "heading",
                                                "|", "quote","unordered-list", "ordered-list",
                                                "|", "link", "image", "table", "|",
                                                "preview", "side-by-side", "fullscreen", "|", "guide"]
                                     });
</script>
<script type=text/javascript>
  $(function() {
    $('a#quick-submit').bind('click', autosave);
  });
  
  function autosave() {
      $.getJSON($SCRIPT_ROOT + '/_quick_save', {
        post_id: $('input[name="post_id"]').val(),
        post_status: $('input[name="post_status"]').val(),
        post_title: $('input[name="title"]').val(),
        post_body: $(document.getElementById('markdown')).val()
      }, function(data) {
        $("#result").text(data.result);
      });
      return false;
    };

  $(function(){
    setInterval(autosave,200000000);
  });
</script>
{% endblock %}
